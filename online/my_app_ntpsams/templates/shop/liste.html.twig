<style>

    .product-card-img {
        height: 200px;
        object-fit: cover;
        object-position: center;
    }
    .product-card {
        border-radius: 15px;
        overflow: hidden;
        border: 1px solid #dee2e6;
    }
    /*.product-image-container {*/
    /*    position: relative;*/
    /*    height: 250px;*/
    /*    overflow: hidden;*/
    /*}*/
    /*.product-image {*/
    /*    width: 100%;*/
    /*    !*height: 100%;*!*/
    /*    !*object-fit: cover;*!*/
    /*    object-fit: contain;*/
    /*    object-position: center;*/
    /*}*/
    .product-image-container {
        position: relative;
        /* Conserve la hauteur fixe du cadre (250px) */
        height: 250px;
        overflow: hidden;

        /* >>> AJOUT CL√â : Centrage de l'image √† l'int√©rieur du cadre <<< */
        display: flex;
        align-items: center; /* Centre verticalement */
        justify-content: center; /* Centre horizontalement */
        /* Utile pour voir les marges vides autour de l'image */
        background-color: #f8f9fa;
    }

    .product-image {
        /* L'image doit utiliser 100% de la largeur et hauteur de son conteneur */
        width: 100%;
        height: 100%;
        /* Propri√©t√© cl√© : L'image sera enti√®rement visible, sans √™tre coup√©e. */
        object-fit: contain;

        object-position: center;
    }




    .product-colors .color-option {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        margin-right: 5px;
        border: 1px solid #ccc;
        cursor: pointer;
    }
    .product-colors .color-option.active {
        border: 2px solid #000;
        box-shadow: 0 0 0 2px #fff;
    }
    .product-sizes .size-option {
        width: 25px;
        height: 25px;
        border: 1px solid #ccc;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: .8em;
        font-weight: bold;
        color: #6c757d;
        cursor: pointer;
        margin-left: 5px;
    }
    .product-sizes .size-option.active {
        border-color: #000;
        color: #000;
    }
    .btn-purple {
        background-color: #6f42c1;
        color: #fff;
        border-color: #6f42c1;
    }
    .btn-purple:hover {
        background-color: #5d35a5;
        border-color: #5d35a5;
		color: #ffffff;
    }
    .current-price {
        font-size: 1.25em;
        font-weight: bold;
        color: #000;
    }
</style>


{% set ORIGINAL_PRICE_KEY = 'Square:a21f62b6-58b5-403d-a2cd-66e8e43e7aea' %}

<div class="container py-5">
    {# Liens de cat√©gories #}
    <div class="d-flex flex-wrap gap-2 my-4">
        <a href="{{ path('app_shop_liste') }}" class="btn btn-outline-primary">
            All
        </a>
        {% for catId, catName in categories %}
            <a href="{{ path('app_shop_liste', { 'cat': catId }) }}" class="btn btn-outline-primary">
                {{ catName }} ({{ categoryCounts[catId] ?? 0 }})
            </a>
        {% endfor %}
    </div>




    <div id="products-container" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
        {% for prod in items %}
            {% set itemData = prod.item_data %}
            {% set categoryId = itemData.categories[0].id ?? null %}



            {% set originalPrice = prod.custom_attribute_values[ORIGINAL_PRICE_KEY].number_value|default(null) %}
            {% set currentPrice = prod.price_text|replace({' USD': '', ',': '.'})|number_format(2, '.', '') %}
            {% set originalPriceNum = originalPrice|default(0) %}





            {# On affiche la carte uniquement si elle correspond √† la cat√©gorie s√©lectionn√©e ou si aucune cat√©gorie n'est s√©lectionn√©e #}
            {% if not selectedCat or selectedCat == categoryId %}

                {% set name = itemData.name ?? "Sans nom" %}
                {% set categoryName = categoryId and categories[categoryId] is defined
                    ? categories[categoryId]
                    : "NONE"
                %}

                <div class="col product-item">
                    <div class="card product-card">
                        <div class="product-image-container">
                            {% if prod.img_url %}
                                <img src="{{ prod.img_url }}" class="card-img-top product-image" alt="{{ name }}">
                            {% else %}
                                <span>Image Empty</span>
                            {% endif %}
                        </div>




                        <div class="card-body">

                            <h5 class="card-title product-title">{{ name }}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">{{ categoryName }}</h6>

                            <div class="d-flex justify-content-between align-items-center mt-3">



                                <div class="product-price text-end">




                                    {# V√©rifie si un prix d'origine (plus √©lev√©) existe #}
                                    {% if prod.original_price is defined and prod.original_price > prod.price %}

                                        {# PRIX R√âEL (Barr√©) #}
                                        <del class="text-muted small d-block" style="font-size: 0.85em;">
                                            {{ prod.original_price }}
                                        </del>

                                        {# PRIX R√âDUIT (Actuel) #}
                                        <span class="current-price text-danger">
                                                {{ prod.price_text }}
                                            </span>
                                        <span class="badge bg-danger ms-1">Promo</span>
                                    {% else %}
                                        {# PRIX NORMAL (Affich√© comme le prix actuel) #}
                                        <span class="current-price text-success">
                                                {{ prod.price_text  }}
                                        </span>

                                    {% endif %}

                                    {# üéØ Bloc s√©par√© pour le PRIX D'ACHAT #}
                                    {% if prod.prixAchat is defined and prod.prixAchat is not empty %}
                                        <div class="mt-2">
                                        <span class="badge bg-secondary" style="font-size: 0.7em;">
                                            Buy: {{ prod.prixAchat }}
                                        </span>
                                        </div>
                                    {% endif %}


                                    {# V√©rifie si le prix barr√© existe et est sup√©rieur au prix actuel #}
                                    {% if originalPrice is not null and originalPriceNum > currentPrice %}

                                        {# PRIX R√âEL (Barr√©) #}
                                        <del class="text-muted small d-block" style="font-size: 0.85em;">
                                            {{ originalPriceNum|number_format(2, ',', ' ') }} USD
                                        </del>
                                        {% endif %}






                                </div>
                                {# Nouveau bloc de prix avec Prix R√©el et R√©duit #}
                                <div class="product-rating">
                                    <i class="bi bi-star-fill text-warning"></i> 4.8
                                </div>
                            </div>

                            <div class="d-flex flex-wrap gap-2 mt-3 justify-content-center">
                                <a href="{{ path('app_shop_product_details', { 'id': prod.id }) }}" class="btn btn-outline-secondary btn-sm flex-grow-1">Details</a>
																
								{% set price_value = prod.price_text | trim %}
								{% if price_value is empty %}
									 <a class="btn btn-purple btn-sm flex-grow-1" href="{{ path('app_shop_redirect_link_extern', { 'id': prod.id }) }}">Appointment</a>
								{% else %}
									 <a class="btn btn-purple btn-sm flex-grow-1" href="{{ path('app_shop_liste', { 'add': prod.id, 'cat': selectedCat }) }}">BUY +</a>
								{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <nav aria-label="Pagination des produits">
        <ul class="pagination justify-content-center mt-4" id="pagination-controls"></ul>
    </nav>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const productItems = document.querySelectorAll('.product-item');
        const productsContainer = document.getElementById('products-container');
        const paginationControls = document.getElementById('pagination-controls');

        const itemsPerPage = 12;
        let currentPage = 1;

        const totalProducts = productItems.length;
        const totalPages = Math.ceil(totalProducts / itemsPerPage);

        function displayProductsForPage(page) {
            currentPage = page;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;

            productItems.forEach((item, index) => {
                item.style.display = (index >= startIndex && index < endIndex) ? 'block' : 'none';
            });

            updatePaginationButtons();
        }

        function setupPagination() {
            paginationControls.innerHTML = '';

            const prevLi = createPaginationItem('Prev', 'prev');
            prevLi.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage > 1) {
                    displayProductsForPage(currentPage - 1);
                }
            });
            paginationControls.appendChild(prevLi);

            for (let i = 1; i <= totalPages; i++) {
                const pageLi = createPaginationItem(i, `page-${i}`);
                pageLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    displayProductsForPage(i);
                });
                paginationControls.appendChild(pageLi);
            }

            const nextLi = createPaginationItem('Next', 'next');
            nextLi.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentPage < totalPages) {
                    displayProductsForPage(currentPage + 1);
                }
            });
            paginationControls.appendChild(nextLi);

            updatePaginationButtons();
        }

        function createPaginationItem(text, className) {
            const li = document.createElement('li');
            li.classList.add('page-item', className);
            const a = document.createElement('a');
            a.classList.add('page-link');
            a.href = '#';
            a.textContent = text;
            li.appendChild(a);
            return li;
        }

        function updatePaginationButtons() {
            document.querySelectorAll('#pagination-controls .page-item').forEach(item => {
                item.classList.remove('active', 'disabled');
            });

            const currentPageBtn = document.querySelector(`.page-${currentPage}`);
            if (currentPageBtn) {
                currentPageBtn.classList.add('active');
            }

            const prevBtn = document.querySelector('.prev');
            if (prevBtn && currentPage === 1) {
                prevBtn.classList.add('disabled');
            }

            const nextBtn = document.querySelector('.next');
            if (nextBtn && currentPage === totalPages) {
                nextBtn.classList.add('disabled');
            }
        }

        displayProductsForPage(currentPage);
        setupPagination();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const navbarCollapse = document.getElementById('ecommerceNavbar');
        const navbarToggler = document.querySelector('.navbar-toggler');

        document.addEventListener('click', function(event) {
            const isClickInsideMenu = navbarCollapse.contains(event.target);
            const isClickOnToggler = navbarToggler.contains(event.target);

            if (navbarCollapse.classList.contains('show') && !isClickInsideMenu && !isClickOnToggler) {
                const bootstrapCollapse = new bootstrap.Collapse(navbarCollapse);
                bootstrapCollapse.hide();
            }
        });
    });
</script>













